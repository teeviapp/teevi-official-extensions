var teevi=(function(){"use strict";const d="https://api.themoviedb.org/3",S="https://image.tmdb.org/t/p",u=(()=>{var a;const e=(a=globalThis.Teevi)==null?void 0:a.getInputValueById("api.token");if(e)return e;throw new Error("API token is not defined")})();async function h(e,a,r){const n=new URL(`${d}/search/${a}`);n.searchParams.append("query",e),n.searchParams.append("include_adult","false"),n.searchParams.append("language",r),n.searchParams.append("page","1");const t=await fetch(n.toString(),{method:"GET",headers:{accept:"application/json",Authorization:`Bearer ${u}`}});if(!t.ok)throw new Error(`Failed to fetch shows for query ${e}`);return(await t.json()).results}async function E(e,a,r){const n=new URL(`${d}/${a}/${e}`);n.searchParams.append("language",r);const t=await fetch(n.toString(),{method:"GET",headers:{accept:"application/json",Authorization:`Bearer ${u}`}});if(!t.ok)throw new Error(`Failed to fetch show details for ${a}:${e}`);return t.json()}async function R(e,a,r){const n=new URL(`${d}/tv/${e}/season/${a}`);n.searchParams.append("language",r);const t=await fetch(n.toString(),{method:"GET",headers:{accept:"application/json",Authorization:`Bearer ${u}`}});if(!t.ok)throw new Error(`Failed to fetch season details for ${e} season ${a}`);return await t.json()}async function T(e,a,r,n){const t=new URL(`${d}/${a}/${e}/images`);t.searchParams.append("language",r),n.length>0&&t.searchParams.append("include_image_language",n.join(","));const i=await fetch(t.toString(),{method:"GET",headers:{accept:"application/json",Authorization:`Bearer ${u}`}});if(!i.ok)throw new Error(`Failed to fetch images for ${a}:${e}: ${i.status} ${i.statusText}`);return i.json()}function c(e,a){return`${S}/${{poster:"w500",logo:"w500",backdrop:"w780",still:"w300"}[a]}/${e}`}async function U(e,a,r){const n=new URL(`${d}/${a}/recommendations`);n.searchParams.append("language",r),n.searchParams.append("page","1");const t=await fetch(n.toString(),{method:"GET",headers:{accept:"application/json",Authorization:`Bearer ${u}`}});if(!t.ok)throw new Error(`Failed to fetch recommendations for show ID ${e}: ${t.status} - ${t.statusText}`);return(await t.json()).results}const p=()=>Teevi.language??"en-US";function f(e){if("release_date"in e&&e.release_date)return e.release_date;if("first_air_date"in e&&e.first_air_date)return e.first_air_date}function g(e){const a="title"in e?"movie":"tv",r=f(e);return{kind:a==="movie"?"movie":"series",id:`${a}/${e.id.toString()}`,title:"title"in e?e.title:e.name,posterURL:c(e.poster_path,"poster"),year:r?new Date(r).getFullYear():void 0}}async function b(e){const[a,r]=await Promise.all([h(e,"movie",p()),h(e,"tv",p())]);return[...a,...r].filter(n=>f(n)!=null&&(n.vote_average??0)>0).sort((n,t)=>t.popularity-n.popularity).map(n=>g(n))}async function k(e){var _,w,$,y,P;const a=o=>{if(!o)return;const s=o.toLowerCase();if(["in production","post production","planned","pilot","rumored","announced"].includes(s))return"upcoming";if(s==="returning series")return"airing";if(s==="canceled")return"canceled";if(s==="released"||s==="ended")return"ended"},[r,n]=e.split("/");if(r!=="movie"&&r!=="tv")throw new Error(`Invalid showId format: ${e}. Expected format: "movie/123" or "tv/456"`);const t=await E(n,r,p()),i=await T(n,r,p(),["en","null"]),m=(_=i.logos.sort((o,s)=>s.vote_average-o.vote_average).find(o=>!o.file_path.endsWith("svg")))==null?void 0:_.file_path,v=(w=i.posters.sort((o,s)=>s.vote_average-o.vote_average).find(o=>!o.iso_639_1&&!o.file_path.endsWith("svg")))==null?void 0:w.file_path,l=r==="movie",j=l?t.runtime:(($=t.episode_run_time)==null?void 0:$[0])||((y=t.last_episode_to_air)==null?void 0:y.runtime),I=l?t.release_date:t.first_air_date,B=l?void 0:t.seasons.filter(o=>o.season_number>0&&o.air_date!=null&&(o.episode_count??0)>0).map(o=>({number:o.season_number,name:o.name})),A=await U(n,r,p());return{kind:l?"movie":"series",id:e,title:"title"in t?t.title:t.name,posterURL:c(t.poster_path,"poster"),cleanPosterURL:v&&c(v,"poster"),backdropURL:c(t.backdrop_path,"backdrop"),logoURL:m?c(m,"logo"):void 0,overview:t.overview,releaseDate:I,duration:(j??0)*60,seasons:B,genres:((P=t.genres)==null?void 0:P.map(o=>o.name))??[],rating:t.vote_average,status:a(t.status),relatedShows:A.map(o=>g(o))}}async function L(e,a){const[r,n]=e.split("/");return r!="tv"?[]:(await R(n,a,p())).episodes.map(i=>({id:`${e}/season=${a}&id=${i.id}`,number:i.episode_number,title:i.name,overview:i.overview,thumbnailURL:c(i.still_path,"still"),duration:i.runtime*60}))}return{fetchShowsByQuery:b,fetchShow:k,fetchEpisodes:L}})();
