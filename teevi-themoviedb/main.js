var teevi=(function(){"use strict";const l="https://api.themoviedb.org/3",k="https://image.tmdb.org/t/p",m=(()=>{var o;const e=(o=globalThis.Teevi)==null?void 0:o.getInputValueById("api.token");if(e)return e;throw new Error("API token is not defined")})();async function _(e,o,n){const t=new URL(`${l}/search/${o}`);t.searchParams.append("query",e),t.searchParams.append("include_adult","false"),t.searchParams.append("language",n),t.searchParams.append("page","1");const a=await fetch(t.toString(),{method:"GET",headers:{accept:"application/json",Authorization:`Bearer ${m}`}});if(!a.ok)throw new Error(`Failed to fetch shows for query ${e}`);return(await a.json()).results}async function E(e,o,n){const t=new URL(`${l}/${o}/${e}`);t.searchParams.append("language",n);const a=await fetch(t.toString(),{method:"GET",headers:{accept:"application/json",Authorization:`Bearer ${m}`}});if(!a.ok)throw new Error(`Failed to fetch show details for ${o}:${e}`);return a.json()}async function R(e,o,n){const t=new URL(`${l}/tv/${e}/season/${o}`);t.searchParams.append("language",n);const a=await fetch(t.toString(),{method:"GET",headers:{accept:"application/json",Authorization:`Bearer ${m}`}});if(!a.ok)throw new Error(`Failed to fetch season details for ${e} season ${o}`);return await a.json()}async function U(e,o,n,t){const a=new URL(`${l}/${o}/${e}/images`);a.searchParams.append("language",n),t.length>0&&a.searchParams.append("include_image_language",t.join(","));const s=await fetch(a.toString(),{method:"GET",headers:{accept:"application/json",Authorization:`Bearer ${m}`}});if(!s.ok)throw new Error(`Failed to fetch images for ${o}:${e}: ${s.status} ${s.statusText}`);return s.json()}function h(e,o){return`${k}/${{poster:"w500",logo:"w500",backdrop:"w780",still:"w300"}[o]}/${e}`}async function L(e,o,n){const t=new URL(`${l}/${o}/${e}/recommendations`);t.searchParams.append("language",n),t.searchParams.append("page","1");const a=await fetch(t.toString(),{method:"GET",headers:{accept:"application/json",Authorization:`Bearer ${m}`}});if(!a.ok)throw new Error(`Failed to fetch recommendations for show ID ${e}: ${a.status} - ${a.statusText}`);return(await a.json()).results}async function j(e,o,n){let t;switch(n.sorting){case"popularity":t=n.ascending?"popularity.asc":"popularity.desc";break;case"rating":t=n.ascending?"vote_average.asc":"vote_average.desc";break;case"release_date":e=="movie"?t=n.ascending?"primary_release_date.asc":"primary_release_date.desc":t=n.ascending?"first_air_date.asc":"first_air_date.desc";break}async function a(p){const u=new URL(`${l}/discover/${e}`);u.searchParams.append("language",o??"en"),u.searchParams.append("page",String(p)),u.searchParams.append("vote_count.gte","500"),t&&u.searchParams.append("sort_by",t);const f=await fetch(u.toString(),{method:"GET",headers:{accept:"application/json",Authorization:`Bearer ${m}`}});if(!f.ok)throw new Error(`Failed to fetch shows from discover at page ${p}: ${f.status} - ${f.statusText}`);return f.json()}let s=1,g=1;const v=n.maximumPages,d=[];for(;s<=g&&s<=v;){const p=await a(s);d.push(...p.results),s++,g=p.total_pages}return d}const c=()=>Teevi.language??"en-US";function $(e){if("release_date"in e&&e.release_date)return e.release_date;if("first_air_date"in e&&e.first_air_date)return e.first_air_date}function w(e){const o="title"in e?"movie":"tv",n=$(e);return{kind:o==="movie"?"movie":"series",id:`${o}/${e.id.toString()}`,title:"title"in e?e.title:e.name,posterURL:h(e.poster_path,"poster"),year:n?new Date(n).getFullYear():void 0}}async function B(e){const[o,n]=await Promise.all([_(e,"movie",c()),_(e,"tv",c())]);return[...o,...n].filter(t=>$(t)!=null&&(t.vote_average??0)>0).sort((t,a)=>a.popularity-t.popularity).map(t=>w(t))}async function F(e){var y,P,S,b,T;const o=r=>{if(!r)return;const i=r.toLowerCase();if(["in production","post production","planned","pilot","rumored","announced"].includes(i))return"upcoming";if(i==="returning series")return"airing";if(i==="canceled")return"canceled";if(i==="released"||i==="ended")return"ended"},[n,t]=e.split("/");if(n!=="movie"&&n!=="tv")throw new Error(`Invalid showId format: ${e}. Expected format: "movie/123" or "tv/456"`);const a=await E(t,n,c()),s=await U(t,n,c(),["en","null"]),g=(y=s.logos.sort((r,i)=>i.vote_average-r.vote_average).find(r=>!r.file_path.endsWith("svg")))==null?void 0:y.file_path,v=(P=s.posters.sort((r,i)=>i.vote_average-r.vote_average).find(r=>!r.iso_639_1&&!r.file_path.endsWith("svg")))==null?void 0:P.file_path,d=n==="movie",p=d?a.runtime:((S=a.episode_run_time)==null?void 0:S[0])||((b=a.last_episode_to_air)==null?void 0:b.runtime),u=d?a.release_date:a.first_air_date,f=d?void 0:a.seasons.filter(r=>r.season_number>0&&r.air_date!=null&&(r.episode_count??0)>0).map(r=>({number:r.season_number,name:r.name})),x=await L(t,n,c());return{kind:d?"movie":"series",id:e,title:"title"in a?a.title:a.name,posterURL:h(a.poster_path,"poster"),cleanPosterURL:v&&h(v,"poster"),backdropURL:h(a.backdrop_path,"backdrop"),logoURL:g?h(g,"logo"):void 0,overview:a.overview,releaseDate:u,duration:(p??0)*60,seasons:f,genres:((T=a.genres)==null?void 0:T.map(r=>r.name))??[],rating:a.vote_average,status:o(a.status),relatedShows:x.map(r=>w(r))}}async function I(e,o){const[n,t]=e.split("/");return n!="tv"?[]:(await R(t,o,c())).episodes.map(s=>({id:`${e}/season=${o}&id=${s.id}`,number:s.episode_number,title:s.name,overview:s.overview,thumbnailURL:h(s.still_path,"still"),duration:s.runtime*60}))}return{fetchShowsByQuery:B,fetchShow:F,fetchEpisodes:I,fetchFeedCollections:async()=>{const e=[],o=[{type:"movie",sorting:"popularity",category:"hot",name:"Popular Movies",id:"tmdb-popular-movies"},{type:"tv",sorting:"popularity",category:"hot",name:"Popular TV Shows",id:"tmdb-popular-tv-shows"},{type:"movie",sorting:"rating",category:"recommended",name:"Top Rated Movies",id:"tmdb-top-rated-movies"},{type:"tv",sorting:"rating",category:"recommended",name:"Top Rated TV Shows",id:"tmdb-top-rated-tv-shows"},{type:"movie",sorting:"release_date",category:"new",name:"New Movies",id:"tmdb-new-movies"},{type:"tv",sorting:"release_date",category:"new",name:"New TV Shows",id:"tmdb-new-tv-shows"}];for(const n of o){const t=await j(n.type,c(),{sorting:n.sorting,maximumPages:4});e.push({id:n.id,name:n.name,shows:t.map(w),category:n.category})}return e},fetchTrendingShows:async()=>[]}})();
